<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>給食タイマー</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@100;300;400;500;700;800;900&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="index.css">
    <script>
        var timeMath = {
            sub: function () {
                var result, times, second,
                    len = arguments.length;

                if (len === 0) return;

                for (var i = 0; i < len; i++) {
                    if (!arguments[i] || !arguments[i].match(/^[0-9]+:[0-9]{2}:[0-9]{2}$/)) continue;

                    times = arguments[i].split(':');

                    second = this.toSecond(times[0], times[1], times[2]);

                    if (!second) continue;

                    if (i === 0) {
                        result = second;
                    } else {
                        result -= second;
                    }
                }

                return this.toTimeFormat(result);
            },

            /**
            

            /**
             * 時間を秒に変換
             */
            toSecond: function (hour, minute, second) {
                if ((!hour && hour !== 0) || (!minute && minute !== 0) || (!second && second !== 0) ||
                    hour === null || minute === null || second === null ||
                    typeof hour === 'boolean' ||
                    typeof minute === 'boolean' ||
                    typeof second === 'boolean' ||
                    typeof Number(hour) === 'NaN' ||
                    typeof Number(minute) === 'NaN' ||
                    typeof Number(second) === 'NaN') return;

                return (Number(hour) * 60 * 60) + (Number(minute) * 60) + Number(second);
            },

            /**
             * 秒を時間（hh:mm:ss）のフォーマットに変換
             */
            toTimeFormat: function (fullSecond) {
                var hour, minute, second;

                if ((!fullSecond && fullSecond !== 0) || !String(fullSecond).match(/^[\-0-9][0-9]*?$/)) return;

                var paddingZero = function (n) {
                    return (n < 10) ? '0' + n : n;
                };

                hour = Math.floor(Math.abs(fullSecond) / 3600);
                minute = Math.floor(Math.abs(fullSecond) % 3600 / 60);
                second = Math.floor(Math.abs(fullSecond) % 60);

                minute = paddingZero(minute);
                second = paddingZero(second);

                return ((fullSecond < 0) ? '-' : '') + hour + ':' + minute + ':' + second;
            }
        };
    </script>
</head>

<body>
    <h1>給食タイマー</h1>
    <form>
        <label for="time">目標時間</label>
        <input type="time" value="16:40" name="time" id="timeform">

    </form>
    <p>現在時刻<br><span id="nowtime"></span></p>
    <p>目標時刻<br><span id="attime"></span></p>

    <script>
        function getCookie(cookieName) {
            let name = cookieName + "=";
            let decodedCookie = decodeURIComponent(document.cookie);
            let cookieArray = decodedCookie.split(';');

            for (let i = 0; i < cookieArray.length; i++) {
                let cookie = cookieArray[i].trim();
                if (cookie.indexOf.name == 0) {
                    return cookie.substring(name.length, cookie.length)
                }

                return null
            }
        }

        let timeform = document.querySelector("input#timeform");

        let now_time = setInterval(() => {
            let times = new Date()
            let time = `${String(times.getHours()).padStart(2, '0')}:${String(times.getMinutes()).padStart(2, '0')}:${String(times.getSeconds()).padStart(2, '0')}`;
            document.querySelector('span#nowtime').innerHTML = time;
        }, 500);
        let at_time = setInterval(() => {
            let now_time = new Date();
            let at_time = document.querySelector('input#timeform').value;
            let time1 = now_time.getFullYear() + "/" + (now_time.getMonth() + 1) + "/" + now_time.getDate() + " " + at_time.split(':')[0] + ":" + at_time.split(':')[1] + ":0";
            let res1 = new Date(time1);
            res1.setMinutes(res1.getMinutes()+1);
            let time2 = now_time.getTime() - res1.getTime();
            let res2_1 = Math.floor(time2 / (1000 * 60) * -1);
            let res2_2 = Math.floor(time2 / (1000) * -1);
            if(res2_1.length<=1)res2_1="0"+res2_1;
            if(res2_2.length<=1)res2_2="0"+res2_2;
            let res3 = res2_1 + ":" + (res2_2 - (res2_1 * 60))
            document.querySelector('span#attime').innerHTML = res3;
        }, 500);
    </script>
</body>

</html>