<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>給食タイマー</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@100;300;400;500;700;800;900&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="index.css">
</head>

<body>
    <h1>給食タイマー</h1>
    <form>
        <label for="time">目標時間</label>
        <input type="time" value="12:40" name="time" id="timeform">

    </form>
    <p>現在時刻<br><span id="nowtime"></span></p>
    <p>目標時刻<br><span id="attime"></span></p>
    <audio src="audio/stop.mp3" controls></audio>

    <script>
        var stop_a = false
        let timeform = document.querySelector("input#timeform");

        timeform.addEventListener('change',()=>{
            stop_a = false
        });
        let now_time = setInterval(() => {
            let times = new Date()
            let time = `${String(times.getHours()).padStart(2, '0')}:${String(times.getMinutes()).padStart(2, '0')}:${String(times.getSeconds()).padStart(2, '0')}`;
            document.querySelector('span#nowtime').innerHTML = time;
        }, 500);
        let at_time = setInterval(() => {
            let now_time = new Date();
            let at_time = document.querySelector('input#timeform').value;
            let time1 = now_time.getFullYear() + "/" + (now_time.getMonth() + 1) + "/" + now_time.getDate() + " " + at_time.split(':')[0] + ":" + at_time.split(':')[1] + ":0";
            let res1 = new Date(time1);
            res1.setMinutes(res1.getMinutes());
            res1.setSeconds(res1.getSeconds()+1)
            let time2 = now_time.getTime() - res1.getTime();
            let res2_1 = Math.floor(time2 / (1000 * 60) * -1);
            let res2_2 = Math.floor(time2 / (1000) * -1);
            res2_1=`${res2_1}`;
            res2_2=`${res2_2}`;
            if(res2_1<0){
                res2_1=60-res2_1
            }
            if(res2_1.length<=1)res2_1="0"+res2_1;
            if(res2_2.length<=1)res2_2="0"+res2_2;
            let res3 = res2_1 + ":" + (res2_2 - (res2_1*60))
            document.querySelector('span#attime').innerHTML = res3;
            if(res2_1<0 || (res2_1==0 && res2_2==0)){
                if(!stop_a){
                    document.querySelector('audio').play();
                    stop_a=true
                }
            }
        }, 500);
    </script>
</body>

</html>